<!DOCTYPE html>
<html lang="zh-cn">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8">
	<title>应用接入指南</title>

	<!-- mobile responsive meta -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="description" content="How to access OpenTenBase">
	
	<meta name="author" content="Themefisher">
	
	
        <meta name="theme-name" content="meghna-hugo" />
	<meta name="generator" content="Hugo 0.126.1">

	<!-- plugins -->
	
	<link rel="stylesheet" href="http://localhost:1313/plugins/bootstrap/bootstrap.min.css">
	
	<link rel="stylesheet" href="http://localhost:1313/plugins/themify-icons/themify-icons.css">
	
	<link rel="stylesheet" href="http://localhost:1313/plugins/magnific-popup/magnific-popup.css">
	
	<link rel="stylesheet" href="http://localhost:1313/plugins/slick/slick.css">
	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Anaheim%7cQuattrocento&#43;Sans:400,700&amp;display=swap">
	

	<!-- Main Stylesheet -->
	
	<link rel="stylesheet" href="http://localhost:1313/css/style.min.css" media="screen">

	<!-- Custom stylesheet - for your changes -->
	
  <link rel="stylesheet" href="http://localhost:1313/css/custom.min.css" media="screen">

	<!--Favicon-->
	<link rel="shortcut icon" href="http://localhost:1313/images/favicon.png" type="image/x-icon">
	<link rel="icon" href="http://localhost:1313/images/favicon.png" type="image/x-icon">

	

</head>


<body id="body" data-spy="scroll" data-target=".navbar" data-offset="55">
  <div id="content">
    


<section class="sticky-top navigation">
  <div class="container padding-0">
    <nav class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand p-0" href="/">
        
        <img
          class="lozad navigation-logo-layout"
          data-src="http://localhost:1313/images/logo.png"
          alt="OpenTenBase"
          height="42"
        />
        
      </a>

      <button
        class="navbar-toggler rounded-0"
        type="button"
        data-toggle="collapse"
        data-target="#navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse title-layout" id="navigation">
        <ul class="navbar-nav ml-auto">
          
               
          <li class="nav-item navbar-brand">
            <a
              class="nav-link"
              
              href="/#news"
            >新闻</a
            >
          </li>
               
          <li class="nav-item navbar-brand">
            <a
              class="nav-link"
              
              href="/#blog"
            >文章</a
            >
          </li>
               
          <li class="nav-item navbar-brand">
            <a
              class="nav-link"
              
              href="/#event"
            >活动</a
            >
          </li>
               
          <li class="nav-item navbar-brand">
            <a
              class="nav-link"
              target="_blank"
              rel="noopener"
              
              href="https://docs.opentenbase.org/"
            >文档</a
            >
          </li>
               
          <li class="nav-item navbar-brand">
            <a
              class="nav-link"
              
              href="/event/certification"
            >认证</a
            >
          </li>
               
          <li class="nav-item navbar-brand">
            <a
              class="nav-link"
              target="_blank"
              rel="noopener"
              
              href="https://github.com/OpenTenBase/OpenTenBase/tags"
            >下载</a
            >
          </li>
               
          <li class="nav-item navbar-brand">
            <a
              class="nav-link"
              target="_blank"
              rel="noopener"
              
              href="https://github.com/OpenTenBase/OpenTenBase"
            >源码</a
            >
          </li>
           
        </ul>
        
        <select id="select-language" onchange="location = this.value;">
          
          
          
          
          
          
          
          
          <option id="cn" value="http://localhost:1313/blog/02-access/" selected>中文
          </option>
          
          
          
          
          
          
        </select>
        
      </div>
    </nav>
  </div>
</section>


<section class="section bg-one-single">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 offset-lg-2 text-center ">
        <p class="title h2">应用接入指南</p>
        <ul class="list-inline mb-50">
          <li class="list-inline-item">
            <a class="btn btn-link padding-0" href="/author/opentenbase/">OpenTenBase
            </a>
          </li>
          <li class="list-inline-item">Monday, Sep 25, 2023</li>
        </ul>

      </div>
      <div class="col-lg-8 offset-lg-2">
        <div class="post-single-content">
          <blockquote>
<p>在<a href="/blog/01-quickstart/">快速入门</a>文章中我们介绍了 OpenTenBase 的架构、源码编译安装、集群运行状态、启动停止等内容。</p>
<p>本篇将介绍应用程序如何连接 OpenTenBase 数据库进行建库、建表、数据导入、查询等操作。</p>
</blockquote>
<p>OpenTenBase 兼容所有支持 Postgres 协议的客户端连接，这里将详细介绍 JAVA、C 语音、shell 语言、Python、PHP、Golang 这 6 种最常用的开发语言连接 OpenTenBase 的操作方法。</p>
<h2 id="1java-开发">1、JAVA 开发</h2>
<h3 id="11创建数据表">1.1、创建数据表</h3>
<pre tabindex="0"><code>import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.Statement;


public class createtable {
   public static void main( String args[] )
     {
       Connection c = null;
       Statement stmt = null;
       try {
         Class.forName(&#34;org.postgresql.Driver&#34;);
         c = DriverManager.getConnection(&#34;jdbc:postgresql://127.0.0.1:15432/postgres?currentSchema=public&amp;binaryTransfer=false&#34;,&#34;opentenbase&#34;, &#34;opentenbase&#34;);
         System.out.println(&#34;Opened database successfully&#34;);
         stmt = c.createStatement();
         String sql = &#34;create table opentenbase(id int,nickname text) distribute by shard(id) to group  default_group&#34; ;
         stmt.executeUpdate(sql);
         stmt.close();
         c.close();
       } catch ( Exception e ) {
         System.err.println( e.getClass().getName()+&#34;: &#34;+ e.getMessage() );
         System.exit(0);
       }
       System.out.println(&#34;Table created successfully&#34;);
     }
}
</code></pre><p>说明：</p>
<ul>
<li>这里连接的节点为任意 CN 主节点，后面所有操作，没特别说明，都是连接到 CN 主节点进行操作。</li>
</ul>
<h3 id="12使用普通协议插入数据">1.2、使用普通协议插入数据</h3>
<pre tabindex="0"><code>import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.Statement;

public class insert {
   public static void main(String args[]) {
      Connection c = null;
      Statement stmt = null;
      try {
         Class.forName(&#34;org.postgresql.Driver&#34;);
         c = DriverManager.getConnection(&#34;jdbc:postgresql://127.0.0.1:15432/postgres?currentSchema=public&amp;binaryTransfer=false&#34;,&#34;opentenbase&#34;, &#34;opentenbase&#34;);
         c.setAutoCommit(false);
         System.out.println(&#34;Opened database successfully&#34;);

         stmt = c.createStatement();
         String sql = &#34;INSERT INTO opentenbase (id,nickname) &#34;
               + &#34;VALUES (1,&#39;opentenbase&#39;);&#34;;
         stmt.executeUpdate(sql);

         sql = &#34;INSERT INTO opentenbase (id,nickname) &#34;
               + &#34;VALUES (2, &#39;pgxz&#39; ),(3,&#39;pgxc&#39;);&#34;;
         stmt.executeUpdate(sql);
         stmt.close();
         c.commit();
         c.close();
      } catch (Exception e) {
         System.err.println( e.getClass().getName()+&#34;: &#34;+ e.getMessage() );
         System.exit(0);
      }
      System.out.println(&#34;Records created successfully&#34;);
   }
}
</code></pre><h3 id="13使用扩展协议插入数据">1.3、使用扩展协议插入数据</h3>
<pre tabindex="0"><code>import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.*;
import java.util.Random;

public class insert_prepared {
   public static void main(String args[]) {
      Connection c = null;
      PreparedStatement stmt;
      try {
         Class.forName(&#34;org.postgresql.Driver&#34;);
         c = DriverManager.getConnection(&#34;jdbc:postgresql://127.0.0.1:15432/postgres?currentSchema=public&amp;binaryTransfer=false&#34;,&#34;opentenbase&#34;, &#34;opentenbase&#34;);
         c.setAutoCommit(false);
         System.out.println(&#34;Opened database successfully&#34;);
         //插入数据
         String sql = &#34;INSERT INTO opentenbase (id,nickname) VALUES (?,?)&#34;;
         stmt = c.prepareStatement(sql);
         stmt.setInt(1, 9999);
         stmt.setString(2, &#34;opentenbase_prepared&#34;);
         stmt.executeUpdate();

         //插入更新
         sql = &#34;INSERT INTO opentenbase (id,nickname) VALUES (?,?) ON CONFLICT(id) DO UPDATE SET nickname=?&#34;;
         stmt = c.prepareStatement(sql);
         stmt.setInt(1, 9999);
         stmt.setString(2, &#34;opentenbase_prepared&#34;);
         stmt.setString(3, &#34;opentenbase_prepared_update&#34;);
         stmt.executeUpdate();

         stmt.close();
         c.commit();
         c.close();
      } catch (Exception e) {
         System.err.println( e.getClass().getName()+&#34;: &#34;+ e.getMessage() );
         System.exit(0);
      }
      System.out.println(&#34;Records created successfully&#34;);
   }
}
</code></pre><h3 id="14copy-from-加载文件到表">1.4、copy from 加载文件到表</h3>
<pre tabindex="0"><code>import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.Statement;
import org.postgresql.copy.CopyManager;
import org.postgresql.core.BaseConnection;
import java.io.*;

public class copyfrom {
   public static void main( String args[] )
     {
       Connection c = null;
       Statement stmt = null;
       FileInputStream fs = null;
       try {
         Class.forName(&#34;org.postgresql.Driver&#34;);
         c = DriverManager.getConnection(&#34;jdbc:postgresql://127.0.0.1:15432/postgres?currentSchema=public&amp;binaryTransfer=false&#34;,&#34;opentenbase&#34;, &#34;opentenbase&#34;);
         System.out.println(&#34;Opened database successfully&#34;);
         CopyManager cm = new CopyManager((BaseConnection) c);
         fs = new FileInputStream(&#34;/data/opentenbase/opentenbase.csv&#34;);
         String sql = &#34;COPY opentenbase FROM STDIN DELIMITER AS &#39;,&#39;&#34;;
         cm.copyIn(sql, fs);
         c.close();
         fs.close();
       } catch ( Exception e ) {
         System.err.println( e.getClass().getName()+&#34;: &#34;+ e.getMessage() );
         System.exit(0);
       }
       System.out.println(&#34;Copy data successfully&#34;);
     }
}
</code></pre><h3 id="15copy-to-导出数据到文件">1.5、copy to 导出数据到文件</h3>
<pre tabindex="0"><code>import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.Statement;
import org.postgresql.copy.CopyManager;
import org.postgresql.core.BaseConnection;
import java.io.*;

public class copyto {
   public static void main( String args[] )
     {
       Connection c = null;
       Statement stmt = null;
       FileOutputStream fs = null;
       try {
         Class.forName(&#34;org.postgresql.Driver&#34;);
         c = DriverManager.getConnection(&#34;jdbc:postgresql://127.0.0.1:15432/postgres?currentSchema=public&amp;binaryTransfer=false&#34;,&#34;opentenbase&#34;, &#34;opentenbase&#34;);
         System.out.println(&#34;Opened database successfully&#34;);
         CopyManager cm = new CopyManager((BaseConnection) c);
         fs = new FileOutputStream(&#34;/data/opentenbase/opentenbase.csv&#34;);
         String sql = &#34;COPY opentenbase TO STDOUT DELIMITER AS &#39;,&#39;&#34;;
         cm.copyOut(sql, fs);
         c.close();
         fs.close();
       } catch ( Exception e ) {
         System.err.println( e.getClass().getName()+&#34;: &#34;+ e.getMessage() );
         System.exit(0);
       }
       System.out.println(&#34;Copy data successfully&#34;);
     }
}
</code></pre><h3 id="16jdbc-包下载地址">1.6、jdbc 包下载地址</h3>
<pre tabindex="0"><code>https://jdbc.postgresql.org/download.html
</code></pre><h2 id="2c-程序开发">2、C 程序开发</h2>
<h3 id="21连接数据库">2.1、连接数据库</h3>
<pre tabindex="0"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &#34;libpq-fe.h&#34;
int
main(int argc, char **argv){
    const char *conninfo;
    PGconn     *conn;
    if (argc &gt; 1){
        conninfo = argv[1];
    }else{
        conninfo = &#34;dbname = postgres&#34;;
    }
    conn = PQconnectdb(conninfo);
    if (PQstatus(conn) != CONNECTION_OK){
        fprintf(stderr, &#34;连接数据库失败: %s&#34;,PQerrorMessage(conn));
    }else{
        printf(&#34;连接数据库成功！\n&#34;);
    }
    PQfinish(conn);
    return 0;
}
</code></pre><p>编译</p>
<pre tabindex="0"><code>gcc -c -I /usr/local/install/opentenbase_pgxz/include/ conn.c
gcc -o conn conn.o -L /usr/local/install/opentenbase_pgxz/lib/ -lpq
</code></pre><p>运行</p>
<pre tabindex="0"><code>./conn &#34;host=172.16.0.3 dbname=postgres port=11000&#34;
连接数据库成功！
</code></pre><pre tabindex="0"><code>./conn &#34;host=172.16.0.3 dbname=postgres port=15432 user=opentenbase&#34;
连接数据库成功！
</code></pre><h3 id="22建立数据表">2.2、建立数据表</h3>
<pre tabindex="0"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &#34;libpq-fe.h&#34;
int
main(int argc, char **argv){
    const char *conninfo;
    PGconn     *conn;
    PGresult   *res;
    const char *sql = &#34;create table opentenbase(id int,nickname text) distribute by shard(id) to group  default_group&#34;;
    if (argc &gt; 1){
        conninfo = argv[1];
    }else{
        conninfo = &#34;dbname = postgres&#34;;
    }
    conn = PQconnectdb(conninfo);
    if (PQstatus(conn) != CONNECTION_OK){
        fprintf(stderr, &#34;连接数据库失败: %s&#34;,PQerrorMessage(conn));
    }else{
        printf(&#34;连接数据库成功！\n&#34;);
    }
    res = PQexec(conn,sql);
    if(PQresultStatus(res) != PGRES_COMMAND_OK){
        fprintf(stderr, &#34;建立数据表失败: %s&#34;,PQresultErrorMessage(res));
    }else{
        printf(&#34;建立数据表成功！\n&#34;);
    }
    PQclear(res);
    PQfinish(conn);
    return 0;
}
</code></pre><p>编译</p>
<pre tabindex="0"><code>gcc -c -I /usr/local/install/opentenbase_pgxz/include/ createtable.c
gcc -o createtable createtable.o -L /usr/local/install/opentenbase_pgxz/lib/ -lpq
</code></pre><p>运行</p>
<pre tabindex="0"><code>./createtable &#34;port=11000 dbname=postgres&#34;
连接数据库成功！
建立数据表成功！
</code></pre><h3 id="23插入数据">2.3、插入数据</h3>
<pre tabindex="0"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &#34;libpq-fe.h&#34;
int
main(int argc, char **argv){
    const char *conninfo;
    PGconn     *conn;
    PGresult   *res;
    const char *sql = &#34;INSERT INTO opentenbase (id,nickname) values(1,&#39;opentenbase&#39;),(2,&#39;pgxz&#39;)&#34;;
    if (argc &gt; 1){
        conninfo = argv[1];
    }else{
        conninfo = &#34;dbname = postgres&#34;;
    }
    conn = PQconnectdb(conninfo);
    if (PQstatus(conn) != CONNECTION_OK){
        fprintf(stderr, &#34;连接数据库失败: %s&#34;,PQerrorMessage(conn));
    }else{
        printf(&#34;连接数据库成功！\n&#34;);
    }
    res = PQexec(conn,sql);
    if(PQresultStatus(res) != PGRES_COMMAND_OK){
        fprintf(stderr, &#34;插入数据失败: %s&#34;,PQresultErrorMessage(res));
    }else{
        printf(&#34;插入数据成功！\n&#34;);
    }
    PQclear(res);
    PQfinish(conn);
    return 0;
}
</code></pre><p>编译</p>
<pre tabindex="0"><code>gcc -c -I /usr/local/install/opentenbase_pgxz/include/ insert.c
gcc -o insert insert.o -L /usr/local/install/opentenbase_pgxz/lib/ -lpq
</code></pre><p>运行</p>
<pre tabindex="0"><code>./insert &#34;dbname=postgres port=15432&#34;
</code></pre><h3 id="24查询数据">2.4、查询数据</h3>
<pre tabindex="0"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &#34;libpq-fe.h&#34;
int
main(int argc, char **argv){
    const char *conninfo;
    PGconn     *conn;
    PGresult   *res;
    const char *sql = &#34;select * from opentenbase&#34;;
    if (argc &gt; 1){
        conninfo = argv[1];
    }else{
        conninfo = &#34;dbname = postgres&#34;;
    }
    conn = PQconnectdb(conninfo);
    if (PQstatus(conn) != CONNECTION_OK){
        fprintf(stderr, &#34;连接数据库失败: %s&#34;,PQerrorMessage(conn));
    }else{
        printf(&#34;连接数据库成功！\n&#34;);
    }
    res = PQexec(conn,sql);
    if(PQresultStatus(res) != PGRES_TUPLES_OK){
        fprintf(stderr, &#34;插入数据失败: %s&#34;,PQresultErrorMessage(res));
    }else{
        printf(&#34;查询数据成功！\n&#34;);
        int rownum = PQntuples(res) ;
        int colnum = PQnfields(res);
        for(int j = 0;j&lt; colnum; ++j){
            printf(&#34;%s\t&#34;,PQfname(res,j));
        }
        printf(&#34;\n&#34;);
        for(int i = 0;i&lt; rownum; ++i){
            for(int j = 0;j&lt; colnum; ++j){
                printf(&#34;%s\t&#34;,PQgetvalue(res,i,j));
            }
            printf(&#34;\n&#34;);
        }
    }
    PQclear(res);
    PQfinish(conn);
    return 0;
}
</code></pre><p>编译</p>
<pre tabindex="0"><code>gcc -std=c99 -c -I /usr/local/install/opentenbase_pgxz/include/ select.c
gcc -o select select.o -L /usr/local/install/opentenbase_pgxz/lib/ -lpq
</code></pre><p>运行</p>
<pre tabindex="0"><code>./select &#34;dbname=postgres port=15432&#34;
连接数据库成功！
查询数据成功！
id      nickname
1       opentenbase
2       pgxz
</code></pre><h3 id="25流数据-copy-入表">2.5、流数据 COPY 入表</h3>
<pre tabindex="0"><code>#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &#34;libpq-fe.h&#34;
int
main(int argc, char **argv){
    const char *conninfo;
    PGconn     *conn;
    PGresult   *res;
    const char *buffer = &#34;1,opentenbase\n2,pgxz\n3,opentenbase牛&#34;;
    if (argc &gt; 1){
        conninfo = argv[1];
    }else{
        conninfo = &#34;dbname = postgres&#34;;
    }
    conn = PQconnectdb(conninfo);
    if (PQstatus(conn) != CONNECTION_OK){
        fprintf(stderr, &#34;连接数据库失败: %s&#34;,PQerrorMessage(conn));
    }else{
        printf(&#34;连接数据库成功！\n&#34;);
    }
    res=PQexec(conn,&#34;COPY opentenbase FROM STDIN DELIMITER &#39;,&#39;;&#34;);
    if(PQresultStatus(res) != PGRES_COPY_IN){
        fprintf(stderr, &#34;copy数据出错1: %s&#34;,PQresultErrorMessage(res));
    }else{
        int len = strlen(buffer);
        if(PQputCopyData(conn,buffer,len) == 1){
             if(PQputCopyEnd(conn,NULL) == 1){
                res = PQgetResult(conn);
                if(PQresultStatus(res) == PGRES_COMMAND_OK){
                    printf(&#34;copy数据成功！\n&#34;);
                }else{
                    fprintf(stderr, &#34;copy数据出错2: %s&#34;,PQerrorMessage(conn));
                }
             }else{
                fprintf(stderr, &#34;copy数据出错3: %s&#34;,PQerrorMessage(conn));
             }
        }else{
            fprintf(stderr, &#34;copy数据出错4: %s&#34;,PQerrorMessage(conn));
        }
    }
    PQclear(res);
    PQfinish(conn);
    return 0;
}
</code></pre><p>编译</p>
<pre tabindex="0"><code>gcc -c -I /usr/local/install/opentenbase_pgxz/include/ copy.c
gcc -o copy copy.o -L /usr/local/install/opentenbase_pgxz/lib/ -lpq
</code></pre><p>执行</p>
<pre tabindex="0"><code>./copy &#34;dbname=postgres port=15432&#34;
连接数据库成功！
copy数据成功！
</code></pre><h3 id="3shell-脚本开发">3、shell 脚本开发</h3>
<pre tabindex="0"><code>#!/bin/sh

if [ $# -ne 0 ]
then
    echo &#34;usage: $0 exec_sql&#34;
    exit 1
fi

exec_sql=$1

masters=`psql -h 172.16.0.29 -d postgres -p 15432 -t -c &#34;select string_agg(node_host, &#39; &#39;) from (select * from pgxc_node where node_type = &#39;D&#39; order by node_name) t&#34;`
port_list=`psql -h 172.16.0.29 -d postgres -p 15432 -t -c &#34;select string_agg(node_port::text, &#39; &#39;) from (select * from pgxc_node where node_type = &#39;D&#39; order by node_name) t&#34;`
node_cnt=`psql -h 172.16.0.29 -d postgres -p 15432 -t -c &#34;select count(*) from pgxc_node where node_type = &#39;D&#39;&#34;`
masters=($masters)
ports=($port_list)

echo $node_cnt

flag=0

for((i=0;i&lt;$node_cnt;i++));
do
    seq=$(($i+1))
    master=${masters[$i]}
    port=${ports[$i]}
    echo $master
    echo $port

    psql -h $master -p $port  postgres -c &#34;$exec_sql&#34;
done
</code></pre><h2 id="4python-程序开发">4、python 程序开发</h2>
<h3 id="41安装-psycopg2-模块">4.1、安装 psycopg2 模块</h3>
<pre tabindex="0"><code>[root@VM_0_29_centos ~]# yum install python-psycopg2
</code></pre><h3 id="42连接数据库">4.2、连接数据库</h3>
<pre tabindex="0"><code>#coding=utf-8
#!/usr/bin/python
import psycopg2
try:
    conn = psycopg2.connect(database=&#34;postgres&#34;, user=&#34;opentenbase&#34;, password=&#34;&#34;, host=&#34;172.16.0.29&#34;, port=&#34;15432&#34;)
    print &#34;连接数据库成功&#34;
    conn.close()
except psycopg2.Error,msg:
    print &#34;连接数据库出错，错误详细信息： %s&#34; %(msg.args[0])
</code></pre><p>运行</p>
<pre tabindex="0"><code>[opentenbase@VM_0_29_centos python]$ python conn.py
连接数据库成功
</code></pre><h3 id="43创建数据表">4.3、创建数据表</h3>
<pre tabindex="0"><code>#coding=utf-8
#!/usr/bin/python
import psycopg2
try:
    conn = psycopg2.connect(database=&#34;postgres&#34;, user=&#34;opentenbase&#34;, password=&#34;&#34;, host=&#34;172.16.0.29&#34;, port=&#34;15432&#34;)
    print &#34;连接数据库成功&#34;
    cur = conn.cursor()
    sql = &#34;&#34;&#34;
          create table opentenbase
          (
              id int,
              nickname varchar(100)
          )distribute by shard(id) to group default_group
          &#34;&#34;&#34;
    cur.execute(sql)
    conn.commit()
    print &#34;建立数据表成功&#34;
    conn.close()
except psycopg2.Error,msg:
    print &#34;OpenTenBase Error %s&#34; %(msg.args[0])
</code></pre><p>运行</p>
<pre tabindex="0"><code>[opentenbase@VM_0_29_centos python]$ python createtable.py
连接数据库成功
建立数据表成功
</code></pre><h3 id="44插入数据">4.4、插入数据</h3>
<pre tabindex="0"><code>#coding=utf-8
#!/usr/bin/python
import psycopg2
try:
    conn = psycopg2.connect(database=&#34;postgres&#34;, user=&#34;opentenbase&#34;, password=&#34;&#34;, host=&#34;172.16.0.29&#34;, port=&#34;15432&#34;)
    print &#34;连接数据库成功&#34;
    cur = conn.cursor()
    sql = &#34;insert into opentenbase values(1,&#39;opentenbase&#39;),(2,&#39;opentenbase&#39;);&#34;
    cur.execute(sql)
    sql = &#34;insert into opentenbase values(%s,%s)&#34;
    cur.execute(sql,(3,&#39;pg&#39;))
    conn.commit()
    print &#34;插入数据成功&#34;
    conn.close()
except psycopg2.Error,msg:
    print &#34;操作数据库出库 %s&#34; %(msg.args[0])
</code></pre><p>运行</p>
<pre tabindex="0"><code>[opentenbase@VM_0_29_centos python]$ python insert.py
连接数据库成功
插入数据成功
</code></pre><h3 id="45查询数据">4.5、查询数据</h3>
<pre tabindex="0"><code>#coding=utf-8
#!/usr/bin/python
import psycopg2
try:
    conn = psycopg2.connect(database=&#34;postgres&#34;, user=&#34;opentenbase&#34;, password=&#34;&#34;, host=&#34;172.16.0.29&#34;, port=&#34;15432&#34;)
    print &#34;连接数据库成功&#34;
    cur = conn.cursor()
    sql = &#34;select * from opentenbase&#34;
    cur.execute(sql)
    rows = cur.fetchall()
    for row in rows:
        print &#34;ID = &#34;, row[0]
        print &#34;NICKNAME = &#34;, row[1],&#34;\n&#34;
    conn.close()
except psycopg2.Error,msg:
    print &#34;操作数据库出库 %s&#34; %(msg.args[0])
</code></pre><p>运行</p>
<pre tabindex="0"><code>[opentenbase@VM_0_29_centos python]$ python select.py
连接数据库成功
ID =  1
NICKNAME =  opentenbase

ID =  2
NICKNAME =  pgxz

ID =  3
NICKNAME =  pg
</code></pre><h3 id="46copy-from-加载文件到表">4.6、copy from 加载文件到表</h3>
<pre tabindex="0"><code>#coding=utf-8
#!/usr/bin/python
import psycopg2
try:
    conn = psycopg2.connect(database=&#34;postgres&#34;, user=&#34;opentenbase&#34;, password=&#34;&#34;, host=&#34;172.16.0.29&#34;, port=&#34;15432&#34;)
    print &#34;连接数据库成功&#34;
    cur = conn.cursor()
    filename = &#34;/data/opentenbase/opentenbase.txt&#34;
    cols = (&#39;id&#39;,&#39;nickname&#39;)
    tablename=&#34;public.opentenbase&#34;
    cur.copy_from(file=open(filename),table=tablename,columns=cols,sep=&#39;,&#39;)
    conn.commit()
    print &#34;导入数据成功&#34;
    conn.close()
except psycopg2.Error,msg:
    print &#34;操作数据库出库 %s&#34; %(msg.args[0])
</code></pre><p>执行</p>
<pre tabindex="0"><code>[opentenbase@VM_0_29_centos python]$ python copy_from.py
连接数据库成功
导入数据成功
</code></pre><h2 id="5php-程序开发">5、PHP 程序开发</h2>
<h3 id="51连接数据库">5.1、连接数据库</h3>
<pre tabindex="0"><code>&lt;?php
$host=&#34;172.16.0.29&#34;;
$port=&#34;15432&#34;;
$dbname=&#34;postgres&#34;;
$user=&#34;opentenbase&#34; ;
$password=&#34;&#34;;

//连接数据库
$conn=@pg_connect(&#34;host=$host port=$port dbname=$dbname user=$user password=$password&#34;);
if (!$conn){
    $error_msg=@pg_errormessage($conn);
    echo &#34;连接数据库出错，详情：&#34;.$error_msg.&#34;\n&lt;BR&gt;&#34;; ;
    exit;
}else{
    echo &#34;连接数据库成功&#34;.&#34;\n&lt;BR&gt;&#34;;
}
//关闭连接
pg_close($conn);
?&gt;
</code></pre><p>执行</p>
<pre tabindex="0"><code>[root@VM_0_47_centos test]# curl http://127.0.0.1:8080/dbsta/test/conn.php
连接数据库成功
</code></pre><h3 id="52创建数据表">5.2、创建数据表</h3>
<pre tabindex="0"><code>&lt;?php
$host=&#34;172.16.0.29&#34;;
$port=&#34;15432&#34;;
$dbname=&#34;postgres&#34;;
$user=&#34;opentenbase&#34; ;
$password=&#34;&#34;;

//连接数据库
$conn=@pg_connect(&#34;host=$host port=$port dbname=$dbname user=$user password=$password&#34;);
if (!$conn){
    $error_msg=@pg_errormessage($conn);
    echo &#34;连接数据库出错，详情：&#34;.$error_msg.&#34;\n&#34;; ;
    exit;
}else{
    echo &#34;连接数据库成功&#34;.&#34;\n&#34;;
}

//建立数据表
$sql=&#34;create table public.opentenbase(id integer,nickname varchar(100)) distribute by shard(id) to group default_group;&#34;;
$result = @pg_exec($conn,$sql) ;
if (!$result){
    $error_msg=@pg_errormessage($conn);
    echo &#34;创建数据表出错，详情：&#34;.$error_msg.&#34;\n&#34;; ;
    exit;
}else{
    echo &#34;创建数据表成功&#34;.&#34;\n&#34;;
}
//关闭连接
pg_close($conn);
?&gt;
</code></pre><p>执行</p>
<pre tabindex="0"><code>[root@VM_0_47_centos test]# curl http://127.0.0.1:8080/dbsta/test/createtable.php
连接数据库成功
创建数据表成功
</code></pre><h3 id="53插入数据">5.3、插入数据</h3>
<pre tabindex="0"><code>&lt;?php
$host=&#34;172.16.0.29&#34;;
$port=&#34;15432&#34;;
$dbname=&#34;postgres&#34;;
$user=&#34;opentenbase&#34; ;
$password=&#34;&#34;;

//连接数据库
$conn=@pg_connect(&#34;host=$host port=$port dbname=$dbname user=$user password=$password&#34;);
if (!$conn){
    $error_msg=@pg_errormessage($conn);
    echo &#34;连接数据库出错，详情：&#34;.$error_msg.&#34;\n&#34;; ;
    exit;
}else{
    echo &#34;连接数据库成功&#34;.&#34;\n&#34;;
}

//插入数据
$sql=&#34;insert into public.opentenbase values(1,&#39;opentenbase&#39;),(2,&#39;pgxz&#39;);&#34;;
$result = @pg_exec($conn,$sql) ;
if (!$result){
    $error_msg=@pg_errormessage($conn);
    echo &#34;插入数据出错，详情：&#34;.$error_msg.&#34;\n&#34;;
    exit;
}else{
    echo &#34;插入数据成功&#34;.&#34;\n&#34;;
}

//关闭连接
pg_close($conn);

?&gt;
</code></pre><p>执行</p>
<pre tabindex="0"><code>[opentenbase@VM_0_47_centos test]$ curl http://127.0.0.1:8080/dbsta/test/insert.php
连接数据库成功
插入数据成功
</code></pre><h3 id="54查询数据">5.4、查询数据</h3>
<pre tabindex="0"><code>&lt;?php
$host=&#34;172.16.0.29&#34;;
$port=&#34;15432&#34;;
$dbname=&#34;postgres&#34;;
$user=&#34;opentenbase&#34; ;
$password=&#34;&#34;;

//连接数据库
$conn=@pg_connect(&#34;host=$host port=$port dbname=$dbname user=$user password=$password&#34;);
if (!$conn){
    $error_msg=@pg_errormessage($conn);
    echo &#34;连接数据库出错，详情：&#34;.$error_msg.&#34;\n&#34;; ;
    exit;
}else{
    echo &#34;连接数据库成功&#34;.&#34;\n&#34;;
}

//查询数据
$sql=&#34;select id,nickname from public.opentenbase&#34;;
$result = @pg_exec($conn,$sql) ;
if (!$result){
    $error_msg=@pg_errormessage($conn);
    echo &#34;查询数据出错，详情：&#34;.$error_msg.&#34;\n&#34;;
    exit;
}else{
    echo &#34;插入数据成功&#34;.&#34;\n&#34;;
}
$record_num = pg_numrows($result);
echo &#34;返回记录数&#34;.$record_num.&#34;\n&#34;;
$rec=pg_fetch_all($result);
for($i=0;$i&lt;$record_num;$i++){
    echo &#34;记录数#&#34;.strval($i+1).&#34;\n&#34;;
    echo &#34;id：&#34;.$rec[$i][&#34;id&#34;].&#34;\n&#34;;
    echo &#34;nickname：&#34;.$rec[$i][&#34;nickname&#34;].&#34;\n\n&#34;;
}
//关闭连接
pg_close($conn);
?&gt;
</code></pre><p>调用方法</p>
<pre tabindex="0"><code>[root@VM_0_47_centos ~]# curl http://127.0.0.1:8080/dbsta/test/select.php
连接数据库成功
插入数据成功
返回记录数2
记录数#1
id：1
nickname：opentenbase

记录数#2
id：2
nickname：pgxz
</code></pre><h3 id="55流数据-copy-入表">5.5、流数据 copy 入表</h3>
<pre tabindex="0"><code>&lt;?php

$host=&#34;172.16.0.29&#34;;
$port=&#34;15432&#34;;
$dbname=&#34;postgres&#34;;
$user=&#34;opentenbase&#34; ;
$password=&#34;&#34;;

//连接数据库
$conn=@pg_connect(&#34;host=$host port=$port dbname=$dbname user=$user password=$password&#34;);
if (!$conn){
    $error_msg=@pg_errormessage($conn);
    echo &#34;连接数据库出错，详情：&#34;.$error_msg.&#34;\n&#34;; ;
    exit;
}else{
    echo &#34;连接数据库成功&#34;.&#34;\n&#34;;
}
$row=ARRAY(&#34;1,opentenbase&#34;,&#34;2,pgxz&#34;);
$flag=pg_copy_from($conn,&#34;public.opentenbase&#34;,$row,&#34;,&#34;);

if (!$flag){
    $error_msg=@pg_errormessage($conn);
    echo &#34;copy出错，详情：&#34;.$error_msg.&#34;\n&#34;;
}else{
    echo &#34;copy成功&#34;.&#34;\n&#34;;
}

//关闭连接
pg_close($conn);

?&gt;
</code></pre><p>调用方法</p>
<pre tabindex="0"><code>curl http://127.0.0.1/dbsta/cron/php_copy_from.php
连接数据库成功
copy成功
</code></pre><h3 id="56copy-to-导出数据到一个数组中">5.6、copy to 导出数据到一个数组中</h3>
<pre tabindex="0"><code>&lt;?php

$host=&#34;172.16.0.29&#34;;
$port=&#34;15432&#34;;
$dbname=&#34;postgres&#34;;
$user=&#34;opentenbase&#34; ;
$password=&#34;&#34;;

//连接数据库
$conn=@pg_connect(&#34;host=$host port=$port dbname=$dbname user=$user password=$password&#34;);
if (!$conn){
    $error_msg=@pg_errormessage($conn);
    echo &#34;连接数据库出错，详情：&#34;.$error_msg.&#34;\n&#34;; ;
    exit;
}else{
    echo &#34;连接数据库成功&#34;.&#34;\n&#34;;
}

$row=pg_copy_to($conn,&#34;public.opentenbase&#34;,&#34;,&#34;);
if (!$row){
    $error_msg=@pg_errormessage($conn);
    echo &#34;copy出错，详情：&#34;.$error_msg.&#34;\n&#34;;
}else{
    print_r($row);
}
//关闭连接
pg_close($conn);
?&gt;
</code></pre><p>调用方法</p>
<pre tabindex="0"><code>curl http://127.0.0.1/dbsta/cron/php_copy_to.php
连接数据库成功
Array
(
    [0] =&gt; 1,opentenbase

    [1] =&gt; 2,pgxz

)
</code></pre><h2 id="6golang-程序开发">6、golang 程序开发</h2>
<h3 id="61连接数据库">6.1、连接数据库</h3>
<pre tabindex="0"><code>package main

import (
    &#34;fmt&#34;
    &#34;time&#34;

    &#34;github.com/jackc/pgx&#34;
)

func main() {
    var error_msg string

    //连接数据库
    conn, err := db_connect()
    if err != nil {
        error_msg = &#34;连接数据库失败，详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    }
    //程序运行结束时关闭连接
    defer conn.Close()
    write_log(&#34;Log&#34;, &#34;连接数据库成功&#34;)

}

/*
功能描述：写入日志处理

参数说明：
log_level -- 日志级别，只能是是Error或Log
error_msg -- 日志内容

返回值说明：无
*/

func write_log(log_level string, error_msg string) {
    //打印错误信息
    fmt.Println(&#34;访问时间：&#34;, time.Now().Format(&#34;2006-01-02 15:04:05&#34;))
    fmt.Println(&#34;日志级别：&#34;, log_level)
    fmt.Println(&#34;详细信息：&#34;, error_msg)
}

/*
功能描述：连接数据库

参数说明：无

返回值说明：
conn *pgx.Conn -- 连接信息
err error --错误信息

*/

func db_connect() (conn *pgx.Conn, err error) {
    var config pgx.ConnConfig
    config.Host = &#34;127.0.0.1&#34;    //数据库主机host或ip
    config.User = &#34;opentenbase&#34;         //连接用户
    config.Password = &#34;pgsql&#34;    //用户密码
    config.Database = &#34;postgres&#34; //连接数据库名
    config.Port = 15432          //端口号
    conn, err = pgx.Connect(config)
    return conn, err
}
</code></pre><pre tabindex="0"><code>[root@VM_0_29_centos opentenbase]# go run conn.go
访问时间： 2018-04-03 20:40:28
日志级别： Log
详细信息： 连接数据库成功
</code></pre><p>编译后运行</p>
<pre tabindex="0"><code>[root@VM_0_29_centos opentenbase]# go build conn.go
[root@VM_0_29_centos opentenbase]# ./conn
访问时间： 2018-04-03 20:40:48
日志级别： Log
详细信息： 连接数据库成功
</code></pre><h3 id="62创建数据表">6.2、创建数据表</h3>
<pre tabindex="0"><code>package main

import (
    &#34;fmt&#34;
    &#34;time&#34;

    &#34;github.com/jackc/pgx&#34;
)

func main() {
    var error_msg string
    var sql string

    //连接数据库
    conn, err := db_connect()
    if err != nil {
        error_msg = &#34;连接数据库失败，详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    }
    //程序运行结束时关闭连接
    defer conn.Close()
    write_log(&#34;Log&#34;, &#34;连接数据库成功&#34;)

    //建立数据表
    sql = &#34;create table public.opentenbase(id varchar(20),nickname varchar(100)) distribute by shard(id) to group  default_group;&#34;
    _, err = conn.Exec(sql)
    if err != nil {
        error_msg = &#34;创建数据表失败,详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    } else {
        write_log(&#34;Log&#34;, &#34;创建数据表成功&#34;)
    }
}

/*
功能描述：写入日志处理

参数说明：
log_level -- 日志级别，只能是是Error或Log
error_msg -- 日志内容

返回值说明：无
*/

func write_log(log_level string, error_msg string) {
    //打印错误信息
    fmt.Println(&#34;访问时间：&#34;, time.Now().Format(&#34;2006-01-02 15:04:05&#34;))
    fmt.Println(&#34;日志级别：&#34;, log_level)
    fmt.Println(&#34;详细信息：&#34;, error_msg)
}

/*
功能描述：连接数据库

参数说明：无

返回值说明：
conn *pgx.Conn -- 连接信息
err error --错误信息

*/

func db_connect() (conn *pgx.Conn, err error) {
    var config pgx.ConnConfig
    config.Host = &#34;127.0.0.1&#34;    //数据库主机host或ip
    config.User = &#34;opentenbase&#34;         //连接用户
    config.Password = &#34;pgsql&#34;    //用户密码
    config.Database = &#34;postgres&#34; //连接数据库名
    config.Port = 15432          //端口号
    conn, err = pgx.Connect(config)
    return conn, err
}
</code></pre><pre tabindex="0"><code>[root@VM_0_29_centos opentenbase]# go run createtable.go
访问时间： 2018-04-03 20:50:24
日志级别： Log
详细信息： 连接数据库成功
访问时间： 2018-04-03 20:50:24
日志级别： Log
详细信息： 创建数据表成功
</code></pre><h3 id="63插入数据">6.3、插入数据</h3>
<pre tabindex="0"><code>package main

import (
    &#34;fmt&#34;
    &#34;strings&#34;
    &#34;time&#34;

    &#34;github.com/jackc/pgx&#34;
)

func main() {
    var error_msg string
    var sql string
    var nickname string

    //连接数据库
    conn, err := db_connect()
    if err != nil {
        error_msg = &#34;连接数据库失败，详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    }
    //程序运行结束时关闭连接
    defer conn.Close()
    write_log(&#34;Log&#34;, &#34;连接数据库成功&#34;)

    //插入数据
    sql = &#34;insert into public.opentenbase values(&#39;1&#39;,&#39;opentenbase&#39;),(&#39;2&#39;,&#39;pgxz&#39;);&#34;
    _, err = conn.Exec(sql)
    if err != nil {
        error_msg = &#34;插入数据失败,详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    } else {
        write_log(&#34;Log&#34;, &#34;插入数据成功&#34;)
    }

    //绑定变量插入数据,不需要做防注入处理
    sql = &#34;insert into public.opentenbase values($1,$2),($1,$3);&#34;
    _, err = conn.Exec(sql, &#34;3&#34;, &#34;postgresql&#34;, &#34;postgres&#34;)
    if err != nil {
        error_msg = &#34;插入数据失败,详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    } else {
        write_log(&#34;Log&#34;, &#34;插入数据成功&#34;)
    }

    //拼接sql语句插入数据,需要做防注入处理
    nickname = &#34;OpenTenBase is &#39; good!&#34;
    sql = &#34;insert into public.opentenbase values(&#39;1&#39;,&#39;&#34; + sql_data_encode(nickname) + &#34;&#39;)&#34;
    _, err = conn.Exec(sql)
    if err != nil {
        error_msg = &#34;插入数据失败,详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    } else {
        write_log(&#34;Log&#34;, &#34;插入数据成功&#34;)
    }
}

/*
功能描述：sql查询拼接字符串编码

参数说明：
str -- 要编码的字符串

返回值说明：
返回编码过的字符串

*/

func sql_data_encode(str string) string {
    return strings.Replace(str, &#34;&#39;&#34;, &#34;&#39;&#39;&#34;, -1)
}

/*
功能描述：写入日志处理

参数说明：
log_level -- 日志级别，只能是是Error或Log
error_msg -- 日志内容

返回值说明：无
*/

func write_log(log_level string, error_msg string) {
    //打印错误信息
    fmt.Println(&#34;访问时间：&#34;, time.Now().Format(&#34;2006-01-02 15:04:05&#34;))
    fmt.Println(&#34;日志级别：&#34;, log_level)
    fmt.Println(&#34;详细信息：&#34;, error_msg)
}

/*
功能描述：连接数据库

参数说明：无

返回值说明：
conn *pgx.Conn -- 连接信息
err error --错误信息

*/

func db_connect() (conn *pgx.Conn, err error) {
    var config pgx.ConnConfig
    config.Host = &#34;127.0.0.1&#34;    //数据库主机host或ip
    config.User = &#34;opentenbase&#34;         //连接用户
    config.Password = &#34;pgsql&#34;    //用户密码
    config.Database = &#34;postgres&#34; //连接数据库名
    config.Port = 15432          //端口号
    conn, err = pgx.Connect(config)
    return conn, err
}
</code></pre><pre tabindex="0"><code>[root@VM_0_29_centos opentenbase]# go run insert.go
访问时间： 2018-04-03 21:05:51
日志级别： Log
详细信息： 连接数据库成功
访问时间： 2018-04-03 21:05:51
日志级别： Log
详细信息： 插入数据成功
访问时间： 2018-04-03 21:05:51
日志级别： Log
详细信息： 插入数据成功
访问时间： 2018-04-03 21:05:51
日志级别： Log
详细信息： 插入数据成功
</code></pre><h3 id="64查询数据">6.4、查询数据</h3>
<pre tabindex="0"><code>package main

import (
    &#34;fmt&#34;
    &#34;strings&#34;
    &#34;time&#34;

    &#34;github.com/jackc/pgx&#34;
)

func main() {
    var error_msg string
    var sql string

    //连接数据库
    conn, err := db_connect()
    if err != nil {
        error_msg = &#34;连接数据库失败，详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    }
    //程序运行结束时关闭连接
    defer conn.Close()
    write_log(&#34;Log&#34;, &#34;连接数据库成功&#34;)

    sql = &#34;SELECT id,nickname FROM public.opentenbase LIMIT 2&#34;
    rows, err := conn.Query(sql)
    if err != nil {
        error_msg = &#34;查询数据失败,详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    } else {
        write_log(&#34;Log&#34;, &#34;查询数据成功&#34;)
    }

    var nickname string
    var id string

    for rows.Next() {
        err = rows.Scan(&amp;id, &amp;nickname)
        if err != nil {
            error_msg = &#34;执行查询失败，详情：&#34; + err.Error()
            write_log(&#34;Error&#34;, error_msg)
            return
        }
        error_msg = fmt.Sprintf(&#34;id：%s nickname：%s&#34;, id, nickname)
        write_log(&#34;Log&#34;, error_msg)
    }
    rows.Close()

    nickname = &#34;opentenbase&#34;

    sql = &#34;SELECT id,nickname FROM public.opentenbase WHERE nickname =&#39;&#34; + sql_data_encode(nickname) + &#34;&#39; &#34;
    rows, err = conn.Query(sql)
    if err != nil {
        error_msg = &#34;查询数据失败,详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    } else {
        write_log(&#34;Log&#34;, &#34;查询数据成功&#34;)
    }
    defer rows.Close()

    for rows.Next() {
        err = rows.Scan(&amp;id, &amp;nickname)
        if err != nil {
            error_msg = &#34;执行查询失败，详情：&#34; + err.Error()
            write_log(&#34;Error&#34;, error_msg)
            return
        }
        error_msg = fmt.Sprintf(&#34;id：%s nickname：%s&#34;, id, nickname)
        write_log(&#34;Log&#34;, error_msg)
    }
}

/*
功能描述：sql查询拼接字符串编码

参数说明：
str -- 要编码的字符串

返回值说明：
返回编码过的字符串

*/

func sql_data_encode(str string) string {
    return strings.Replace(str, &#34;&#39;&#34;, &#34;&#39;&#39;&#34;, -1)
}

/*
功能描述：写入日志处理

参数说明：
log_level -- 日志级别，只能是是Error或Log
error_msg -- 日志内容

返回值说明：无
*/

func write_log(log_level string, error_msg string) {
    //打印错误信息
    fmt.Println(&#34;访问时间：&#34;, time.Now().Format(&#34;2006-01-02 15:04:05&#34;))
    fmt.Println(&#34;日志级别：&#34;, log_level)
    fmt.Println(&#34;详细信息：&#34;, error_msg)
}

/*
功能描述：连接数据库

参数说明：无

返回值说明：
conn *pgx.Conn -- 连接信息
err error --错误信息

*/

func db_connect() (conn *pgx.Conn, err error) {
    var config pgx.ConnConfig
    config.Host = &#34;127.0.0.1&#34;    //数据库主机host或ip
    config.User = &#34;opentenbase&#34;         //连接用户
    config.Password = &#34;pgsql&#34;    //用户密码
    config.Database = &#34;postgres&#34; //连接数据库名
    config.Port = 15432          //端口号
    conn, err = pgx.Connect(config)
    return conn, err
}
</code></pre><pre tabindex="0"><code>[root@VM_0_29_centos opentenbase]# go run select.go
访问时间： 2018-04-09 10:35:50
日志级别： Log
详细信息： 连接数据库成功
访问时间： 2018-04-09 10:35:50
日志级别： Log
详细信息： 查询数据成功
访问时间： 2018-04-09 10:35:50
日志级别： Log
详细信息： id：2 nickname：opentenbase
访问时间： 2018-04-09 10:35:50
日志级别： Log
详细信息： id：3 nickname：postgresql
访问时间： 2018-04-09 10:35:50
日志级别： Log
详细信息： 查询数据成功
访问时间： 2018-04-09 10:35:50
日志级别： Log
详细信息： id：1 nickname：opentenbase
</code></pre><h3 id="65流数据-copy-from-入表">6.5、流数据 copy from 入表</h3>
<pre tabindex="0"><code>package main

import (
    &#34;fmt&#34;
    &#34;math/rand&#34;
    &#34;time&#34;

    &#34;github.com/jackc/pgx&#34;
)

func main() {
    var error_msg string

    //连接数据库
    conn, err := db_connect()
    if err != nil {
        error_msg = &#34;连接数据库失败，详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    }
    //程序运行结束时关闭连接
    defer conn.Close()
    write_log(&#34;Log&#34;, &#34;连接数据库成功&#34;)

    //构造5000行数据
    inputRows := [][]interface{}{}
    var id string
    var nickname string
    for i := 0; i &lt; 5000; i++ {
        id = fmt.Sprintf(&#34;%d&#34;, rand.Intn(10000))
        nickname = fmt.Sprintf(&#34;%d&#34;, rand.Intn(10000))
        inputRows = append(inputRows, []interface{}{id, nickname})
    }
    copyCount, err := conn.CopyFrom(pgx.Identifier{&#34;opentenbase&#34;}, []string{&#34;id&#34;, &#34;nickname&#34;}, pgx.CopyFromRows(inputRows))
    if err != nil {
        error_msg = &#34;执行copyFrom失败,详情：&#34; + err.Error()
        write_log(&#34;Error&#34;, error_msg)
        return
    }
    if copyCount != len(inputRows) {
        error_msg = fmt.Sprintf(&#34;执行copyFrom失败，copy行数：%d 返回行数为：%d&#34;, len(inputRows), copyCount)
        write_log(&#34;Error&#34;, error_msg)
        return
    } else {
        error_msg = &#34;Copy 记录成功&#34;
        write_log(&#34;Log&#34;, error_msg)
    }

}

/*
功能描述：写入日志处理

参数说明：
log_level -- 日志级别，只能是是Error或Log
error_msg -- 日志内容

返回值说明：无
*/

func write_log(log_level string, error_msg string) {
    //打印错误信息
    fmt.Println(&#34;访问时间：&#34;, time.Now().Format(&#34;2006-01-02 15:04:05&#34;))
    fmt.Println(&#34;日志级别：&#34;, log_level)
    fmt.Println(&#34;详细信息：&#34;, error_msg)
}

/*
功能描述：连接数据库

参数说明：无

返回值说明：
conn *pgx.Conn -- 连接信息
err error --错误信息

*/

func db_connect() (conn *pgx.Conn, err error) {
    var config pgx.ConnConfig
    config.Host = &#34;127.0.0.1&#34;    //数据库主机host或ip
    config.User = &#34;opentenbase&#34;         //连接用户
    config.Password = &#34;pgsql&#34;    //用户密码
    config.Database = &#34;postgres&#34; //连接数据库名
    config.Port = 15432          //端口号
    conn, err = pgx.Connect(config)
    return conn, err
}
</code></pre><pre tabindex="0"><code>[root@VM_0_29_centos opentenbase]# go run copy_from.go
访问时间： 2018-04-09 10:36:40
日志级别： Log
详细信息： 连接数据库成功
访问时间： 2018-04-09 10:36:40
日志级别： Log
详细信息： Copy 记录成功
</code></pre><h3 id="66golang-相关资源包">6.6、golang 相关资源包</h3>
<p>需要 git 的资源包:<br>
<a href="https://github.com/jackc/pgx">https://github.com/jackc/pgx</a><br>
<a href="https://github.com/pkg/errors">https://github.com/pkg/errors</a></p>

        </div>
        
        
        
        
        
        
        
      </div>
    </div>
  </div>
</section>


  </div><!-- end Contact Area -->
<footer id="footer" class="bg-one section-bg">
  <div class="container">
    <div class="row wow fadeInUp" data-wow-duration="500ms">
      <div class="col-xl-12">
        <br>
        <!-- copyright --> 
        <div class="col-lg-9 padding-0" data-wow-duration="500ms">
          <a href="http://localhost:1313/" class="padding-0">
            <img src="http://localhost:1313/images/logo_footer.png" alt="OpenTenBase" height="38"/>
          </a>
        </div>
        <div class="copyright">
          <div>Copyright © 2013 - 2023 Tencent Cloud. All Rights Reserved. 腾讯云 版权所有</div>
        </div>
      </div>
    </div>
  </div>
</footer>
<!-- /footer -->

<!-- Google Map API -->


<!-- JS Plugins -->

<script src="http://localhost:1313/plugins/jquery/jquery.min.js"></script>

<script src="http://localhost:1313/plugins/bootstrap/bootstrap.min.js"></script>

<script src="http://localhost:1313/plugins/slick/slick.min.js"></script>

<script src="http://localhost:1313/plugins/shuffle/shuffle.min.js"></script>

<script src="http://localhost:1313/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>

<script src="http://localhost:1313/plugins/lazy-load/lozad.min.js"></script>

<script src="http://localhost:1313/plugins/google-map/map.js"></script>


<!-- Main Script -->

<script src="http://localhost:1313/js/script.min.329fb3531b4e8efc927e85be20ebfd8edeee826e790bef0b540ad8b75737f8a306f3b43772a7102531d4b631a7811e0a.js" integrity="sha384-Mp&#43;zUxtOjvySfoW&#43;IOv9jt7ugm55C&#43;8LVArYt1c3&#43;KMG87Q3cqcQJTHUtjGngR4K"></script>



</body>

</html>
